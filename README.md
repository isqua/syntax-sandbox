# syntax-sandbox

This repository contains my experiments on creating a query language for [the CodeMirror](https://codemirror.net/). It is arranged as a monorepo so that I can easily try new ideas without dealing with infrastructure.

The application demonstrates how to create custom Query Language for CodeMirror using [the Lezer Parser System](https://lezer.codemirror.net/).

My goal was to create query language that is unbound from an application domain. So the grammar part defines just a syntax for queries, but does not contains any properties or values. Thus, domain specific data can be defined independently of grammar.

## Commands

Start:

```
npm run dev
```

Rebuild grammar:

```
npm run grammar
```

Run tests:

```
npm test
```

## File Structure

1. [main.ts](./src/main.ts) is an entrypoint. It finds the root DOM element and render the app.
1. **Universal query language:** [language](./src/language) contains a set of CodeMirror plugins that implement work with the query language defined in Grammar
    1. [grammar](./src/language/grammar) contains everything about parsing a text to an AST
        1. [QueryLanguage.grammar](./src/language/grammar/QueryLanguage.grammar) grammar definition in terms of [The Lezer Parser System](https://lezer.codemirror.net/). The parser itself is autogenerated based on the grammar file.
    1. [query](./src/language/query/query.ts) a helper to transform AST to query tree, it helps to visualize the parsing result and [test](./src/language/query/query.spec.ts) the parser
    1. [highlighter](./src/language/highlighter) highlights different semantic tokens with different colors
    1. [linter](./src/language/linter) shows errors for improper tokens
    1. [decorator](./src/language/decorator) shows user-defined widgets for some tokens
    1. [autocomplete](./src/language/autocomplete) suggests related tokens to a user
    1. [language](./src/language/language.ts) combines them all
1. **Domain Specific Data**
    1. [data](./src/data) contains some data and declarations that are related to a specific app (e.g. task manager)
        1. [properties](./src/data/properties.ts) describes possible properties and its values available for QL
        1. [persons](./src/data/persons.ts) contains some imaginable “users” that could be used for filtering by an author
    1. [decorator](./src/decorator) defines how to replace query tokens with rich HTML widgets, e.g. it replaces usernames of authors with their names
